//index.html

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CODEPLAY-Immune System Firewall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e5e7eb;
            overflow-x: hidden;
        }
        .hero-bg {
            background-color: #0a0a0a;
            background-image: radial-gradient(#1e3a8a 0.5px, transparent 0.5px), radial-gradient(#1e3a8a 0.5px, #0a0a0a 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }
        .glass-card {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(55, 65, 81, 0.3);
            border-radius: 1rem;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
        }
        .glow-button {
            box-shadow: 0 0 5px #3b82f6, 0 0 10px #3b82f6, 0 0 15px #3b82f6;
        }
        .glow-text {
            text-shadow: 0 0 8px #3b82f6;
        }
        .section-header {
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        /* Styles for the bubbling text effect */
        .bubble-text span {
            display: inline-block;
            transition: transform 0.1s ease-out;
            will-change: transform;
            cursor: pointer;
        }
        .glow-text-pink {
            text-shadow: 0 0 8px #d6479f;
        }

        /* New glow effect for the shield icon */
        .shield-glow {
            animation: pulse-glow 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        @keyframes pulse-glow {
            0%, 100% {
                filter: drop-shadow(0 0 4px rgba(59, 130, 246, 0.8));
            }
            50% {
                filter: drop-shadow(0 0 8px rgba(59, 130, 246, 1));
            }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-gray-900/50 backdrop-blur-md border-b border-gray-800">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <!-- Updated CODEPLAY Logo with new Image -->
            <a href="#" class="flex items-center">
                <img src="assets/picture.jpg" alt="CODEPLAY Logo" class="h-16">
            </a>
            <nav class="hidden md:flex space-x-8">
                <a href="#about" class="text-gray-300 hover:text-blue-400 transition-colors">About</a>
                <a href="#features" class="text-gray-300 hover:text-blue-400 transition-colors">Features</a>
                <a href="#demo" class="text-gray-300 hover:text-blue-400 transition-colors">Live Demo</a>
                <a href="#impact" class="text-gray-300 hover:text-blue-400 transition-colors">Impact</a>
            </nav>
            <button class="md:hidden text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="home" class="hero-bg min-h-screen flex items-center justify-center pt-24 pb-12">
            <div class="container mx-auto px-6 text-center z-10">
                <div class="max-w-4xl mx-auto">
                    <h2 id="cybersecurity-text" class="text-4xl md:text-6xl font-black text-white leading-tight mb-2 bubble-text">
                        CYBERSECURITY
                    </h2>
                    <h2 id="agency-text" class="text-3xl md:text-5xl font-bold text-pink-400 glow-text-pink leading-tight mb-8 bubble-text">
                        IMMUNE&nbsp;FIREWALL&nbsp;SYSTEM
                    </h2>
                    <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                        Your Defense Mission Starts Now.
                    </p>
                    <a href="#demo" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 inline-block glow-button">
                        Analyze a Threat
                    </a>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="py-20 bg-black">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold section-header text-white bubble-text">The &nbsp; Problem &nbsp; & &nbsp; Our &nbsp; Solution</h2>
                </div>
                <div class="flex flex-col md:flex-row gap-12 items-center">
                    <div class="md:w-1/2">
                        <h3 class="text-2xl font-bold text-red-400 mb-4 bubble-text">The &nbsp;Challenge:Evolving&nbsp; Threats</h3>
                        <p class="text-gray-300 leading-relaxed">
                            Today’s cybersecurity systems struggle with zero-day attacks and rapidly evolving malware. Traditional, signature-based firewalls are reactive, leaving networks vulnerable to new and unseen threats. They lack the intelligence to adapt, resulting in a constant, high-stakes race against attackers.
                        </p>
                    </div>
                    <div class="md:w-1/2">
                            <h3 class="text-2xl font-bold text-green-400 mb-4 bubble-text">The &nbsp;Solution: A &nbsp;Digital &nbsp;Immune &nbsp;System</h3>
                        <p class="text-gray-300 leading-relaxed">
                            Inspired by the principles of an immune system, our project applies concepts of detection, memory, and adaptation to digital security. Our AI-powered "Digital Immune System Firewall" creates a proactive, self-learning defense mechanism for your network.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-20 bg-gray-900/80">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold section-header text-white bubble-text">Core &nbsp;Defense &nbsp;Mechanisms</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Feature 1: Innate Defense -->
                    <div class="glass-card p-6 text-center feature-card transition-all duration-300">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600/30 mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Innate </h3>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text"> Defense </h3>
                        <p class="text-gray-400">Utilizes rapid, signature-based detection to block known threats and common malware instantly, forming the first line of defense.</p>
                    </div>

                    <!-- Feature 2: Adaptive Immunity -->
                    <div class="glass-card p-6 text-center feature-card transition-all duration-300">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600/30 mx-auto mb-4">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Adaptive</h3>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Immunity</h3>
                        <p class="text-gray-400">Employs advanced ML-based anomaly detection to identify and neutralize zero-day exploits and unknown, evolving attacks.</p>
                    </div>

                    <!-- Feature 3: Memory Cells -->
                    <div class="glass-card p-6 text-center feature-card transition-all duration-300">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600/30 mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 14l9-5-9-5-9 5 9 5z"/><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20M12 12L8 10l4-2 4 2-4 2z"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Memory </h3>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Cells</h3>
                        <p class="text-gray-400">Once a threat is neutralized, its pattern is stored in a 'memory cell' database for instant recognition and defense in the future.</p>
                    </div>
                    
                    <!-- Feature 4: Quarantine -->
                    <div class="glass-card p-6 text-center feature-card transition-all duration-300">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600/30 mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Quarantine</h3>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">Mode</h3>
                        <p class="text-gray-400">Suspicious traffic, files, and processes are automatically isolated in a secure sandbox for deep analysis without risking network integrity.</p>
                    </div>
                </div>
            </div>

             <!-- Feature 5: DoS Mitigation (New Feature) -->
                    <div class="glass-card p-6 text-center feature-card transition-all duration-300">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-blue-600/30 mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2 text-white bubble-text">DoS Mitigation</h3>
                        <p class="text-gray-400">Monitors traffic rates to detect and block Denial of Service (DoS) attacks by rate-limiting or blackholing flood sources, ensuring network availability.</p>
                    </div>
                </div>
            </div>

        </section>

        <!-- Live Demo Section -->
        <section id="demo" class="py-20 bg-black">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold section-header text-white bubble-text">Live&nbsp; Threat &nbsp;Visualization</h2>
                    <p class="text-gray-400 mt-4 max-w-2xl mx-auto">Our demo visualizes network traffic in real-time, showing digital "immune cells" identifying and neutralizing malicious packets.</p>
                </div>
                <div class="glass-card p-4 md:p-8">
                    <div class="bg-gray-900 rounded-lg p-4 h-[400px] md:h-[500px] flex flex-col md:flex-row gap-4">
                        <div class="md:w-1/3 h-full bg-black/50 rounded-lg p-4 overflow-y-auto">
                            <h4 class="text-lg font-bold text-blue-300 border-b border-gray-700 pb-2 mb-2">Threat Log (Real-time)</h4>
                            <div id="threat-log" class="text-sm font-mono text-gray-300 space-y-2">
                                <!-- Log entries will be added here by JavaScript -->
                            </div>
                        </div>
                        <!-- Network Activity & Adaptation (from first code) -->
                        <div class="md:w-2/3 h-full bg-black/50 rounded-lg p-4 flex flex-col overflow-hidden">
                            <div class="flex items-center justify-between border-b border-gray-700 pb-2 mb-3">
                                <h4 class="text-lg font-bold text-blue-300">Network &nbsp;Activity &nbsp;& &nbsp;Adaptation</h4>
                                <div class="flex items-center gap-2 text-xs">
                                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-500/10 text-yellow-300 border border-yellow-500/20">● Anomaly</span>
                                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-500/10 text-red-300 border border-red-500/20">● Malware/Block</span>
                                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-500/10 text-green-300 border border-green-500/20">● Learned</span>
                                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-purple-500/10 text-purple-300 border border-purple-500/20">● Quarantine</span>
                                </div>
                            </div>
                            <div class="relative flex-grow rounded-lg overflow-hidden">
                                <canvas id="net-canvas" class="absolute inset-0"></canvas>
                                <div class="absolute inset-0 pointer-events-none" style="box-shadow: inset 0 0 80px rgba(0,0,0,0.35)"></div>
                                <div class="absolute bottom-2 right-2 text-[10px] text-gray-500">Interactive&nbsp; visualization</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Impact Section -->
        <section id="impact" class="py-20 bg-gray-900/80">
            <div class="container mx-auto px-6 text-center">
                    <div class="text-center mb-12">
                     <h2 class="text-4xl font-bold section-header text-white bubble-text">Project&nbsp; Impact</h2>
                </div>
                <p class="max-w-3xl mx-auto text-lg text-gray-300 mb-8">
                    This adaptive system drastically reduces false positives, responds to new cyber threats without human intervention, and introduces a more resilient approach to securing digital infrastructure.
                </p>
                <div class="flex flex-wrap justify-center gap-4">
                    <span class="bg-blue-900/50 text-blue-300 text-sm font-medium px-4 py-2 rounded-full">Healthcare</span>
                    <span class="bg-blue-900/50 text-blue-300 text-sm font-medium px-4 py-2 rounded-full">Scientific Research</span>
                    <span class="bg-blue-900/50 text-blue-300 text-sm font-medium px-4 py-2 rounded-full">Finance & Banking</span>
                     <span class="bg-blue-900/50 text-blue-300 text-sm font-medium px-4 py-2 rounded-full">IoT Networks</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-black border-t border-gray-800">
        <div class="container mx-auto px-6 py-8 text-center text-gray-500">
            <p>&copy; 2025 CODEPLAY Team. An adaptive approach to Modern Cybersecurity.</p>
        </div>
    </footer>

    <script>
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        const ws = new WebSocket('ws://localhost:8080');

ws.addEventListener('open', () => {
  console.log('Connected to backend WebSocket');
});

ws.addEventListener('message', event => {
  const msg = JSON.parse(event.data);
  if (msg.type === 'network-event') {
    const data = msg.data;
    // Add to threat log
    addThreatLogFromBackend(data);
    // Highlight node on canvas
    highlightNodeByIP(data.sourceIP, data.status.toUpperCase());
  }
});

function addThreatLogFromBackend(event) {
  if (!threatLogEl) return;
  const logEntry = document.createElement('div');
  logEntry.className = 'flex items-start';

  let typeClass = 'text-yellow-400';
  if (event.status === 'blocked' || event.status === 'quarantined') typeClass = 'text-red-400';
  if (event.status === 'allowed' && event.isAttack === false) typeClass = 'text-green-400';

  logEntry.innerHTML = `
    <span class="font-bold mr-2 ${typeClass}">[${event.status.toUpperCase()}]</span>
    <span>${event.sourceIP} - Protocol: ${event.protocol}, Port: ${event.destinationPort}</span>
  `;

  threatLogEl.prepend(logEntry);
  if (threatLogEl.children.length > 10) {
    threatLogEl.removeChild(threatLogEl.lastChild);
  }
}

        // Split text into spans for the bubbling effect
        function wrapLetters() {
            const elements = document.querySelectorAll('.bubble-text');
            elements.forEach(element => {
                const text = element.textContent;
                element.innerHTML = text.split('').map(letter => {
                    return `<span>${letter}</span>`;
                }).join('');
            });
        }
        
        // Bubbling text effect
        document.addEventListener('mousemove', (e) => {
            const spans = document.querySelectorAll('.bubble-text span');
            spans.forEach(span => {
                const rect = span.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                const distance = Math.hypot(x - e.clientX, y - e.clientY);
                const scale = Math.max(1, 1.5 - distance / 100);
                const translation = Math.max(0, 10 - distance / 15);
                span.style.transform = `scale(${scale}) translateY(-${translation}px)`;
            });
        });

        // ============================
        // Network Activity & Adaptation (from first code)
        // ============================

        // Threat log + highlight mapping
        const threatLogEl = document.getElementById('threat-log');
        const threats = [
            { type: 'ANOMALY',      ip: '192.168.1.102', info: 'Unusual outbound traffic' },
            { type: 'MALWARE',      ip: '203.0.113.45',  info: 'Signature match: Trojan.Gen' },
            { type: 'QUARANTINED', ip: '198.51.100.2',  info: 'Suspicious process isolated' },
            { type: 'LEARNED',      ip: '192.168.1.102', info: 'New signature acquired' },
            { type: 'BLOCK',        ip: '185.125.190.52',info: 'Known C&C Server' },
        ];
        const typeColors = {
            ANOMALY: '#f59e0b',      // yellow
            MALWARE: '#f87171',      // red
            BLOCK: '#ef4444',        // red strong
            QUARANTINED: '#a78bfa', // purple
            LEARNED: '#34d399'       // green
        };
        let threatIndex = 0;

        function addThreatLog() {
            if (!threatLogEl) return;
            const threat = threats[threatIndex];
            const logEntry = document.createElement('div');
            logEntry.className = 'flex items-start';
            let typeClass = 'text-yellow-400';
            if (threat.type === 'MALWARE' || threat.type === 'BLOCK') typeClass = 'text-red-400';
            if (threat.type === 'LEARNED') typeClass = 'text-green-400';
            if (threat.type === 'QUARANTINED') typeClass = 'text-purple-400';

            logEntry.innerHTML = `
                <span class="font-bold mr-2 ${typeClass}">[${threat.type}]</span>
                <span>${threat.ip} - ${threat.info}</span>
            `;
            threatLogEl.prepend(logEntry);
            if (threatLogEl.children.length > 10) {
                threatLogEl.removeChild(threatLogEl.lastChild);
            }

            // Highlight corresponding node on canvas
            highlightNodeByIP(threat.ip, threat.type);

            threatIndex = (threatIndex + 1) % threats.length;
        }

        // Canvas network visualization
        const netCanvas = document.getElementById('net-canvas');
        const ctx = netCanvas ? netCanvas.getContext('2d') : null;
        var W, H;
        let nodes = [];
        const MAX_DIST = 140;
        const NODE_COUNT = () => (window.innerWidth < 640 ? 36 : window.innerWidth < 1024 ? 56 : 76);

        function hexToRgb(hex) {
            const cleaned = hex.replace('#', '');
            const bigint = parseInt(cleaned, 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }
        function rgba({r,g,b}, a) {
            return `rgba(${r}, ${g}, ${b}, ${a})`;
        }

        function resizeCanvas() {
            if (!netCanvas || !ctx) return;
            const parent = netCanvas.parentElement;
            const rect = parent.getBoundingClientRect();
            const dpr = Math.min(2, window.devicePixelRatio || 1);

            W = Math.max(1, rect.width);
            H = Math.max(1, rect.height);

            netCanvas.width = Math.floor(W * dpr);
            netCanvas.height = Math.floor(H * dpr);
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        class Node {
            constructor(x, y) {
                this.x = x; this.y = y;
                const ang = Math.random() * Math.PI * 2;
                const spd = 0.3 + Math.random() * 0.6;
                this.vx = Math.cos(ang) * spd;
                this.vy = Math.sin(ang) * spd;
                this.r = 2 + Math.random() * 1.75;
                this.base = { r:148, g:163, b:184 };
                this.pulse = 0;
                this.highlightColor = null; // hex during highlight, null otherwise
            }
            step() {
                this.x += this.vx; this.y += this.vy;
                if (this.x < 0 || this.x > W) this.vx *= -1;
                if (this.y < 0 || this.y > H) this.vy *= -1;
                if (this.pulse > 0) this.pulse -= 0.02;
            }
            currentRGB() {
                return this.highlightColor ? hexToRgb(this.highlightColor) : this.base;
            }
            draw() {
                const pr = this.r + this.pulse * 8;
                const colorRGB = this.currentRGB();

                // Glowing halo
                const grad = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, pr);
                grad.addColorStop(0, rgba(colorRGB, 1));
                grad.addColorStop(1, rgba(colorRGB, 0));
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(this.x, this.y, pr, 0, Math.PI * 2);
                ctx.fill();

                // Core
                ctx.fillStyle = rgba(colorRGB, 0.9);
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initNodes() {
            nodes = [];
            for (let i = 0; i < NODE_COUNT(); i++) {
                nodes.push(new Node(Math.random() * W, Math.random() * H));
            }
        }

        function draw() {
            if (!ctx) { requestAnimationFrame(draw); return; }
            ctx.clearRect(0, 0, W, H);

            // Connections
            for (let i = 0; i < nodes.length; i++) {
                const n1 = nodes[i];
                for (let j = i + 1; j < nodes.length; j++) {
                    const n2 = nodes[j];
                    const dx = n1.x - n2.x, dy = n1.y - n2.y;
                    const d = Math.hypot(dx, dy);
                    if (d < MAX_DIST) {
                        const a = 1 - d / MAX_DIST;
                        ctx.strokeStyle = `rgba(99, 102, 241, ${0.12 + a * 0.18})`;
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(n1.x, n1.y);
                        ctx.lineTo(n2.x, n2.y);
                        ctx.stroke();
                    }
                }
            }

            // Nodes
            nodes.forEach(n => { n.step(); n.draw(); });

            requestAnimationFrame(draw);
        }

        function ipToIndex(ip) {
            const nums = ip.split('.').map(n => parseInt(n, 10) || 0);
            // Simple hash to map IP to node index
            const hash = nums.reduce((a, b) => ((a << 5) - a) + b, 0) >>> 0;
            return nodes.length ? hash % nodes.length : 0;
        }

        function highlightNodeByIP(ip, type) {
            if (!nodes.length) return;
            const idx = ipToIndex(ip);
            const n = nodes[idx];
            const color = typeColors[type] || '#60a5fa';
            n.highlightColor = color;
            n.pulse = 1.0;

            // Ripple to neighbors
            for (let i = 0; i < nodes.length; i++) {
                if (i === idx) continue;
                const m = nodes[i];
                const d = Math.hypot(n.x - m.x, n.y - m.y);
                if (d < MAX_DIST * 0.8) {
                    m.pulse = Math.max(m.pulse, 0.4 * (1 - d / (MAX_DIST * 0.8)));
                }
            }

            // Restore to base after a short highlight
            setTimeout(() => { n.highlightColor = null; }, 1200);
        }

        function bootCanvas() {
            if (!netCanvas || !ctx) return;
            resizeCanvas();
            initNodes();
            draw();
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            initNodes();
        });

        // Initialize
        window.addEventListener('load', () => {
            wrapLetters();
            bootCanvas();
            setInterval(addThreatLog, 2500);
            addThreatLog(); // initial log
        });
    </script>
</body>

</html>

